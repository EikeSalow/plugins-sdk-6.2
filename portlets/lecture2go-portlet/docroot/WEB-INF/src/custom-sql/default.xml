<?xml version="1.0" encoding="UTF-8"?>
<custom-sql>
    
    <sql id="de.uhh.l2g.plugins.service.persistence.InstitutionFinder.findAllSortedAsTree">
		<![CDATA[
			SELECT myNode.institutionId, myNode.parentId, myNode.name, myNode.typ, myNode.www, myNode.level, myNode.sort, 
			IF(myParent.institutionId>=0, IF(myGrandparent.institutionId>=0, 
			CONCAT(myGrandparent.institutionId, '/', myParent.institutionId, '/', myNode.institutionId), 
			CONCAT('', myParent.institutionId, '/', myNode.institutionId)), 
			CONCAT( myNode.institutionId, '')) AS path 
			FROM lg_institution AS myNode 
			LEFT JOIN lg_institution AS myParent ON myNode.parentId = myParent.institutionId
			LEFT JOIN lg_institution AS myGrandparent ON myParent.parentId = myGrandparent.institutionId 
			ORDER BY path ASC
		]]>
    </sql>
    
    <sql id="de.uhh.l2g.plugins.service.persistence.InstitutionFinder.findByLectureseriesId">
		<![CDATA[
			SELECT lg_institution.institutionId, lg_institution.parentId, lg_institution.name, lg_institution.typ, lg_institution.www, lg_institution.level, lg_institution.sort 
			FROM lg_institution, lg_lectureseries_institution 
			WHERE (lg_lectureseries_institution.lectureseriesId=? AND lg_institution.institutionId=lg_lectureseries_institution.institutionId)
		]]>
    </sql> 

    <sql id="de.uhh.l2g.plugins.service.persistence.LectureseriesFinder.findAllSemesters">
		<![CDATA[
			SELECT semesterName FROM lg_lectureseries WHERE semesterName!='' GROUP BY semesterName
		]]>
    </sql> 

    <sql id="de.uhh.l2g.plugins.service.persistence.ProducerFinder.findProducerIds">
		<![CDATA[
			SELECT p.producerId 
			FROM lg_producer_lectureseries AS pc 
			INNER JOIN lg_producer AS p ON pc.producerId = p.producerId 
			WHERE pc.lectureseriesId = ?
		]]>
    </sql> 
    
    <sql id="de.uhh.l2g.plugins.service.persistence.VideoFinder.resetLectureseriesForVideos">
		<![CDATA[
			UPDATE lg_video SET lectureseriesId=0 WHERE lectureseriesId=?
		]]>
    </sql> 
    
</custom-sql>